<!DOCTYPE html>
<html>
<head>
    <title>Gastos de la Casa PRO</title>
    <style>
        body {
            font-family: Arial;
            max-width: 600px;
            margin: auto;
            padding: 20px;
        }
        h1 { text-align: center; }
        input, button {
            width: 100%;
            padding: 12px;
            margin: 6px 0;
            font-size: 16px;
        }
        .item {
            padding: 10px;
            background: #f3f3f3;
            margin-top: 10px;
            border-radius: 6px;
        }
        #chart {
            margin-top: 20px;
        }
        .section-title {
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<h1>ðŸ“Š Gastos de la Casa PRO</h1>

<input id="descripcion" placeholder="DescripciÃ³n del gasto">
<input id="cantidad" type="number" placeholder="Cantidad (RD$)">
<button onclick="agregarGasto()">Agregar gasto</button>

<div class="section-title">ðŸ“… Lista de Gastos</div>
<div id="lista"></div>

<div class="section-title">ðŸ’° Totales</div>
<p>Total del dÃ­a: RD$ <span id="dia"></span></p>
<p>Total de la semana: RD$ <span id="semana"></span></p>
<p>Total del mes: RD$ <span id="mes"></span></p>

<div class="section-title">ðŸ“ˆ GrÃ¡fico semanal (automÃ¡tico)</div>
<canvas id="chart" width="400" height="200"></canvas>

<script>
let gastos = JSON.parse(localStorage.getItem("gastosCasa")) || [];

function guardar() {
    localStorage.setItem("gastosCasa", JSON.stringify(gastos));
}

function agregarGasto() {
    let descripcion = document.getElementById("descripcion").value;
    let cantidad = parseFloat(document.getElementById("cantidad").value);
    let fecha = new Date().toISOString().split("T")[0];

    if (descripcion && cantidad > 0) {
        gastos.push({ descripcion, cantidad, fecha });
        guardar();
        mostrar();
        actualizarTotales();
        graficar();
    }
}

function mostrar() {
    let lista = document.getElementById("lista");
    lista.innerHTML = "";

    gastos.slice().reverse().forEach(g => {
        let div = document.createElement("div");
        div.className = "item";
        div.textContent = `${g.fecha} â€” ${g.descripcion}: RD$${g.cantidad}`;
        lista.appendChild(div);
    });
}

function actualizarTotales() {
    let hoy = new Date().toISOString().split("T")[0];
    let semana = new Date();
    semana.setDate(semana.getDate() - 7);
    let mes = new Date();
    mes.setDate(1);

    let totalDia = 0;
    let totalSemana = 0;
    let totalMes = 0;

    gastos.forEach(g => {
        let fechaG = new Date(g.fecha);

        if (g.fecha === hoy) totalDia += g.cantidad;
        if (fechaG >= semana) totalSemana += g.cantidad;
        if (fechaG >= mes) totalMes += g.cantidad;
    });

    document.getElementById("dia").textContent = totalDia;
    document.getElementById("semana").textContent = totalSemana;
    document.getElementById("mes").textContent = totalMes;
}

function graficar() {
    let ctx = document.getElementById("chart").getContext("2d");

    let dias = ["Lun","Mar","MiÃ©","Jue","Vie","SÃ¡b","Dom"];
    let hoy = new Date();
    let montos = [0,0,0,0,0,0,0];

    gastos.forEach(g => {
        let fecha = new Date(g.fecha);
        let diff = (hoy - fecha) / (1000*60*60*24);
        let dia = fecha.getDay();
        if (diff <= 6) montos[dia] += g.cantidad;
    });

    new Chart(ctx, {
        type: "bar",
        data: {
            labels: dias,
            datasets: [{
                label: "Gastos (RD$)",
                data: montos
            }]
        }
    });
}
</script>

<!-- LibrerÃ­a de grÃ¡ficos -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
mostrar();
actualizarTotales();
graficar();
</script>

</body>
</html>
